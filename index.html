<!doctype html>
<html lang="th">
 <head>
  <meta charset="UTF-8">
  <title>ChineseClass By Krukong</title>
  <link rel="icon" href="https://img2.pic.in.th/pic/Logoc404dc85753b800c.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
      body { font-family: 'Sarabun', sans-serif; }
      @view-transition { navigation: auto; }
      ::-webkit-scrollbar { width: 6px; height: 6px; }
      ::-webkit-scrollbar-track { background: #1e293b; }
      ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
      .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
      
      .status-box { transition: all 0.2s; }
      .status-none { background: rgba(51, 65, 85, 0.5); border: 1px dashed #475569; color: #94a3b8; }
      .status-done { background: #064e3b; border: 1px solid #059669; color: white; box-shadow: 0 0 10px rgba(16, 185, 129, 0.2); }
      
      .btn-score-active { background-color: #d97706 !important; color: white !important; border-color: #fbbf24 !important; transform: scale(1.05); box-shadow: 0 0 10px rgba(251, 191, 36, 0.3); }

      #toast-notification { transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55), opacity 0.3s; }
      .toast-show { transform: translate(-50%, 0) !important; opacity: 1 !important; }
      
      .fade-in { animation: fadeIn 0.3s ease-in-out; }
      @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
      
      .badge-notify { position: absolute; top: -5px; right: -5px; background: red; color: white; border-radius: 50%; width: 18px; height: 18px; font-size: 10px; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 1px solid white;}
  </style>
 </head>
 <body class="w-full h-full bg-slate-950 text-slate-200">
  <div id="app-root" class="w-full h-full min-h-screen flex items-stretch justify-center">
   <div class="app-wrapper w-full max-w-7xl my-2 md:my-4 mx-2 rounded-2xl bg-slate-900/90 shadow-2xl border border-slate-800 flex flex-col relative overflow-hidden">
    
    <header class="w-full px-6 py-4 border-b border-slate-800 flex flex-col md:flex-row md:items-center md:justify-between gap-3 bg-slate-900 z-10">
     <div class="flex items-center gap-4">
      <img src="https://img2.pic.in.th/pic/Logoc404dc85753b800c.png" alt="School Logo" class="h-20 w-20 object-contain drop-shadow-md bg-white/10 rounded-full p-1 border border-slate-600">
      <div>
        <h1 class="text-2xl font-bold text-white tracking-wide">WNY-Chinese<span class="text-red-500">Class</span> V9.1</h1>
        <p class="text-slate-400 text-xs">‡∏Ñ‡∏£‡∏π‡∏Å‡∏µ‡∏£‡∏ï‡∏¥ ‡∏õ‡∏£‡∏∞‡∏™‡∏û‡∏û‡∏£‡∏£‡∏±‡∏á‡∏™‡∏µ - ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏†‡∏≤‡∏©‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®</p>
      </div>
     </div>
     <nav class="inline-flex rounded-full bg-slate-950 p-1 border border-slate-800">
        <button id="tab-btn-admin" onclick="switchMainTab('admin')" class="px-5 py-2 rounded-full text-sm font-semibold text-slate-400 hover:text-white hover:bg-slate-800 transition-all"><i class="fa-solid fa-chalkboard-user mr-2"></i>‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏π</button> 
        <button id="tab-btn-student" onclick="switchMainTab('student')" class="px-5 py-2 rounded-full text-sm font-semibold text-slate-400 hover:text-white hover:bg-slate-800 transition-all"><i class="fa-solid fa-user-graduate mr-2"></i>‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
     </nav>
    </header>

    <main class="flex-1 w-full px-4 md:px-6 pb-6 overflow-y-auto">
     <div class="w-full max-w-7xl mx-auto mt-6 flex flex-col gap-6">
      
      <div id="section-admin" class="flex flex-col gap-5 hidden">
        
        <div id="admin-login-wrapper" class="flex flex-col items-center justify-center py-10 gap-6">
            <div class="glass p-8 rounded-2xl w-full max-w-sm shadow-xl relative flex flex-col items-center border border-slate-700">
                <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-red-600 to-amber-500"></div>
                <img src="https://img2.pic.in.th/pic/Logoc404dc85753b800c.png" alt="Logo" class="w-32 h-32 object-contain mb-6">
                <h2 class="text-xl font-bold text-white mb-6">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏π</h2>
                <form id="admin-login-form" class="space-y-4 w-full">
                    <input id="admin-username" type="text" placeholder="Username" class="w-full rounded-lg bg-slate-900/80 border border-slate-600 px-4 py-2 text-white">
                    <input id="admin-password" type="password" placeholder="Password" class="w-full rounded-lg bg-slate-900/80 border border-slate-600 px-4 py-2 text-white">
                    <button type="submit" class="w-full py-3 rounded-lg bg-red-700 hover:bg-red-600 text-white font-bold shadow-lg">Login</button>
                </form>
            </div>
        </div>

        <div id="admin-content-wrapper" class="hidden flex flex-col gap-5">
            
            <div class="flex justify-between items-center bg-slate-800/50 p-3 rounded-xl border border-slate-700">
                <div class="flex items-center gap-3">
                    <div class="h-10 w-10 rounded-full bg-red-700 flex items-center justify-center text-lg text-white font-bold shadow-md"><i class="fa-solid fa-user-tie"></i></div>
                    <div>
                        <h3 class="text-sm font-bold text-white">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö (Admin)</h3>
                        <p class="text-[10px] text-slate-400">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: <span class="text-green-400">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß</span></p>
                    </div>
                </div>
                <button onclick="handleAdminLogout()" class="bg-slate-700 hover:bg-red-600 text-slate-300 hover:text-white px-4 py-2 rounded-lg text-xs font-bold transition-all border border-slate-600">
                    <i class="fa-solid fa-power-off mr-2"></i>‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
                </button>
            </div>

            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-2 bg-slate-900/50 p-2 rounded-xl border border-slate-800">
                <button onclick="switchAdminSubTab('basic')" id="menu-basic" class="menu-btn bg-red-800/80 text-white shadow"><i class="fa-solid fa-folder-open"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button> 
                <button onclick="switchAdminSubTab('scan')" id="menu-scan" class="menu-btn text-slate-400 hover:text-white"><i class="fa-solid fa-qrcode"></i> ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</button>
                <button onclick="switchAdminSubTab('attendance')" id="menu-attendance" class="menu-btn text-slate-400 hover:text-white"><i class="fa-solid fa-user-check"></i> ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠</button>
                <button onclick="switchAdminSubTab('check')" id="menu-check" class="menu-btn text-slate-400 hover:text-white"><i class="fa-solid fa-search"></i> ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</button>
                <button onclick="switchAdminSubTab('homework')" id="menu-homework" class="menu-btn text-slate-400 hover:text-white relative">
                    <i class="fa-solid fa-list-check"></i> ‡∏ï‡∏£‡∏ß‡∏à‡∏á‡∏≤‡∏ô
                    <span id="badge-homework" class="badge-notify hidden">0</span>
                </button>
                <button onclick="switchAdminSubTab('report')" id="menu-report" class="menu-btn text-slate-400 hover:text-white"><i class="fa-solid fa-chart-bar"></i> ‡πÄ‡∏Å‡∏£‡∏î</button>
                <button onclick="switchAdminSubTab('attreport')" id="menu-attreport" class="menu-btn text-slate-400 hover:text-white"><i class="fa-solid fa-table"></i> ‡∏ß‡∏±‡∏ô‡∏•‡∏≤</button>
                <button onclick="switchAdminSubTab('material')" id="menu-material" class="menu-btn text-slate-400 hover:text-white"><i class="fa-solid fa-book-open"></i> ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤</button>
            </div>

            <section id="admin-panel-basic" class="admin-panel hidden glass rounded-2xl p-5">
               <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                 <div class="glass p-4 rounded-xl border-l-4 border-l-amber-500 space-y-4">
                    <h4 class="text-sm font-semibold text-white">1. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏¥‡∏ä‡∏≤ & ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h4>
                    <form id="form-subject" class="flex gap-2"><input id="subject-name" class="flex-1 bg-slate-900 border border-slate-600 rounded px-2 py-2 text-xs text-white" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤"><button type="submit" class="bg-amber-600 text-white px-3 py-2 rounded text-xs font-bold">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button></form>
                    <form id="form-class" class="flex gap-2 pt-2 border-t border-slate-700"><input id="class-name" class="flex-1 bg-slate-900 border border-slate-600 rounded px-2 py-2 text-xs text-white" placeholder="‡∏´‡πâ‡∏≠‡∏á"><select id="class-subject-ref" class="w-1/3 bg-slate-900 border border-slate-600 rounded px-2 py-2 text-xs text-white"></select><button type="submit" class="bg-amber-600 text-white px-3 py-2 rounded text-xs font-bold">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button></form>
                 </div>
                 <div class="glass p-4 rounded-xl border-l-4 border-l-blue-500">
                    <h4 class="text-sm font-semibold text-white mb-3">2. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h4>
                    <form id="form-student" class="space-y-3">
                        <div class="grid grid-cols-12 gap-3">
                            <div class="col-span-5"><select id="student-class" class="w-full bg-slate-900 border border-slate-600 rounded px-2 py-2 text-sm text-white"></select></div>
                            <div class="col-span-3"><input id="student-no" type="number" class="w-full bg-slate-900 border border-slate-600 rounded px-2 py-2 text-sm text-white text-center" placeholder="‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà"></div>
                            <div class="col-span-4"><input id="student-id" class="w-full bg-slate-900 border border-slate-600 rounded px-2 py-2 text-sm text-white" placeholder="Scan"></div>
                        </div>
                        <div><input id="student-name" class="w-full bg-slate-900 border border-slate-600 rounded px-3 py-2 text-sm text-white" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•"></div>
                        <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded text-sm font-bold">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                    </form>
                 </div>
               </div>
               
               <div class="glass p-4 rounded-xl border-l-4 border-l-red-500 mt-5">
                     <h4 class="text-sm font-semibold text-white mb-3">3. ‡∏™‡∏£‡πâ‡∏≤‡∏á/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏á‡∏≤‡∏ô (‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡∏´‡∏•‡∏≤‡∏¢‡∏´‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ)</h4>
                     <form id="form-task" class="space-y-3">
                        <div><label class="text-[10px] text-slate-400">1. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤</label><select id="task-subject-filter" class="w-full bg-slate-900 border border-slate-600 rounded px-2 py-2 text-xs text-white" onchange="renderTaskClassCheckboxes()"><option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡πà‡∏≠‡∏ô --</option></select></div>
                        <div><label class="text-[10px] text-slate-400">2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label><div id="task-class-checkboxes" class="grid grid-cols-2 gap-2 bg-slate-900 border border-slate-600 rounded p-2 max-h-32 overflow-y-auto"><div class="text-xs text-slate-500 text-center col-span-2">- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏Å‡πà‡∏≠‡∏ô -</div></div></div>
                        
                         <div class="grid grid-cols-2 gap-3">
                             <div><label class="text-[10px] text-slate-400">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label><select id="task-category" class="w-full bg-slate-900 border border-amber-500 rounded px-2 py-2 text-xs text-amber-500 font-bold"><option value="accum">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏Å‡πá‡∏ö (60)</option><option value="midterm">‡∏Å‡∏•‡∏≤‡∏á‡∏†‡∏≤‡∏Ñ (20)</option><option value="final">‡∏õ‡∏•‡∏≤‡∏¢‡∏†‡∏≤‡∏Ñ (30)</option><option value="special">‡∏û‡∏¥‡πÄ‡∏®‡∏© (5)</option></select></div>
                             <div id="chapter-wrapper"><label class="text-[10px] text-slate-400">‡∏ö‡∏ó‡∏ó‡∏µ‡πà</label><select id="task-chapter" class="w-full bg-slate-900 border border-slate-600 rounded px-2 py-2 text-xs text-white"><option value="1">‡∏ö‡∏ó 1</option><option value="2">‡∏ö‡∏ó 2</option><option value="3">‡∏ö‡∏ó 3</option><option value="4">‡∏ö‡∏ó 4</option><option value="5">‡∏ö‡∏ó 5</option><option value="6">‡∏ö‡∏ó 6</option></select></div>
                         </div>
                         <div class="grid grid-cols-12 gap-2"><div class="col-span-8"><input id="task-name" class="w-full bg-slate-900 border border-slate-600 rounded px-2 py-2 text-xs text-white" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô"></div><div class="col-span-4"><input id="task-max" type="number" class="w-full bg-slate-900 border border-slate-600 rounded px-2 py-2 text-xs text-white text-center" value="10"></div></div>
                         <div class="bg-slate-900/50 p-3 rounded border border-slate-700 space-y-2">
                             <div><label class="text-[10px] text-slate-400">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label><textarea id="task-desc" class="w-full bg-slate-800 border border-slate-600 rounded px-2 py-2 text-xs text-white h-16 resize-none" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÉ‡∏´‡πâ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏±‡∏î‡∏®‡∏±‡∏û‡∏ó‡πå..."></textarea></div>
                             <div><label class="text-[10px] text-slate-400">‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏ô‡∏ö</label><input id="task-link" type="text" class="w-full bg-slate-800 border border-slate-600 rounded px-2 py-2 text-xs text-blue-300" placeholder="https://..."></div>
                         </div>
                         <button type="submit" class="w-full bg-red-700 text-white py-2 rounded text-sm font-bold">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏á‡∏≤‡∏ô (‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏ï‡∏≤‡∏°‡∏´‡πâ‡∏≠‡∏á)</button>
                     </form>
               </div>
            </section>
            
            <section id="admin-panel-homework" class="admin-panel hidden glass rounded-2xl p-5 flex flex-col gap-6">
                <div class="flex justify-between items-center pb-4 border-b border-slate-700">
                    <h3 class="text-xl font-bold text-white"><i class="fa-solid fa-list-check text-amber-500 mr-2"></i>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à (Inbox)</h3>
                    <button onclick="renderIncomingSubmissions()" class="text-xs text-slate-400 hover:text-white"><i class="fa-solid fa-rotate mr-1"></i>‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
                </div>
                <div id="incoming-list" class="grid grid-cols-1 gap-3 overflow-y-auto max-h-[600px] pr-2">
                    </div>
            </section>

            <section id="admin-panel-scan" class="admin-panel hidden glass rounded-2xl p-4 flex flex-col gap-4">
                 <div class="grid grid-cols-1 lg:grid-cols-4 gap-4 h-full min-h-[500px]">
                     <div class="lg:col-span-1 bg-slate-800/50 p-4 rounded-xl border border-slate-700 flex flex-col gap-4">
                         <h3 class="font-bold text-white text-lg"><i class="fa-solid fa-qrcode mr-2"></i>‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (1-10)</h3>
                         <div><label class="text-xs text-slate-400">1. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏á‡∏≤‡∏ô</label><select id="scan-class-select" class="w-full bg-slate-900 border border-slate-600 rounded px-3 py-2 text-xs text-white mb-2"></select><select id="scan-task-select" class="w-full bg-slate-900 border border-amber-600 rounded px-3 py-2 text-xs text-amber-500 font-bold"></select></div>
                         <div class="bg-slate-900/50 p-3 rounded-lg border border-slate-600 flex flex-col gap-2">
                             <label class="text-xs text-slate-400">2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏≠‡πÑ‡∏ß‡πâ</label>
                             <div id="score-buttons-container" class="grid grid-cols-5 gap-1"></div>
                             <button onclick="setScoreMode('manual')" id="btn-score-manual" class="w-full py-2 rounded border border-slate-500 bg-slate-800 text-slate-300 hover:bg-slate-700 text-xs font-bold btn-score-active mt-2">‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏≠‡∏á / ‡πÄ‡∏Å‡∏¥‡∏ô 10 (Max 30)</button>
                         </div>
                         <div><label class="text-xs text-slate-400 block mb-2">3. ‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î</label><input id="scan-score-input" type="text" class="w-full bg-slate-900 border-2 border-slate-500 rounded-xl px-4 py-3 text-lg text-center text-white focus:border-red-500 outline-none" placeholder="‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πÅ‡∏Å‡∏ô..."></div>
                     </div>
                     <div class="lg:col-span-3 bg-slate-900/40 p-4 rounded-xl border border-slate-700 flex flex-col">
                        <div class="flex justify-between items-center mb-4"><h3 class="font-bold text-slate-300">üìã ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (Live Roster)</h3><div class="text-xs text-slate-400 flex gap-2"><span class="px-2 py-1 bg-green-900/50 text-green-400 rounded border border-green-800">‡∏°‡∏µ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏•‡πâ‡∏ß</span><span class="px-2 py-1 bg-slate-800 text-slate-500 rounded border border-slate-600">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ</span></div></div>
                        <div id="score-roster-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3 overflow-y-auto max-h-[600px] p-1"><div class="col-span-full text-center text-slate-500 py-10">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏á‡∏≤‡∏ô...</div></div>
                     </div>
                 </div>
            </section>
            
            <section id="admin-panel-attendance" class="admin-panel hidden glass rounded-2xl p-4 flex flex-col gap-4">
                <div class="grid grid-cols-1 lg:grid-cols-4 gap-4 h-full min-h-[500px]">
                    <div class="lg:col-span-1 bg-slate-800/50 p-4 rounded-xl border border-slate-700 flex flex-col gap-4">
                        <h3 class="font-bold text-white text-lg"><i class="fa-solid fa-barcode"></i> ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠</h3>
                        <div><label class="text-xs text-slate-400">‡∏´‡πâ‡∏≠‡∏á & ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label><select id="att-class-select" class="w-full bg-slate-900 border border-slate-600 rounded px-3 py-2 text-sm text-white mb-2 mt-1"></select><input id="att-date-input" type="date" class="w-full bg-slate-900 border border-slate-600 rounded px-3 py-2 text-sm text-white font-mono"></div>
                        <div class="space-y-2"><button onclick="setAttMode('‡∏°‡∏≤')" id="btn-att-present" class="w-full py-3 rounded border border-green-600 bg-green-900/20 text-green-400 font-bold flex justify-between px-4"><span>‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</span> <i class="fa-solid fa-check"></i></button><button onclick="setAttMode('‡∏•‡∏≤')" id="btn-att-leave" class="w-full py-3 rounded border border-yellow-600 bg-yellow-900/20 text-yellow-400 font-bold flex justify-between px-4"><span>‡∏•‡∏≤</span> <i class="fa-solid fa-envelope"></i></button><button onclick="setAttMode('‡∏Ç‡∏≤‡∏î')" id="btn-att-absent" class="w-full py-3 rounded border border-red-600 bg-red-900/20 text-red-400 font-bold flex justify-between px-4"><span>‡∏Ç‡∏≤‡∏î</span> <i class="fa-solid fa-xmark"></i></button></div>
                        <input id="att-scan-input" type="text" class="w-full bg-slate-900 border-2 border-slate-500 rounded-xl px-4 py-3 text-lg text-center text-white outline-none" placeholder="‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πÅ‡∏Å‡∏ô..." disabled>
                    </div>
                    <div class="lg:col-span-3 bg-slate-900/40 p-4 rounded-xl border border-slate-700 flex flex-col">
                        <div class="flex justify-between items-center mb-4"><h3 class="font-bold text-slate-300">üìã ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ (Live)</h3></div>
                        <div id="att-roster-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3 overflow-y-auto max-h-[600px] p-1"></div>
                    </div>
                </div>
            </section>
            
            <section id="admin-panel-check" class="admin-panel hidden glass rounded-2xl p-5 flex flex-col gap-6">
                <div class="flex flex-col md:flex-row gap-3 items-center bg-slate-800/60 p-4 rounded-xl border border-slate-700">
                    <select id="check-class-filter" class="bg-slate-900 border border-slate-600 rounded-lg px-3 py-3 text-white outline-none w-full md:w-auto" onchange="performCheck()"></select>
                    <input id="check-student-input" type="text" class="flex-1 w-full bg-slate-900 border border-amber-500/50 rounded-lg px-4 py-3 text-white outline-none focus:border-amber-500 focus:ring-1 focus:ring-amber-500 transition-all text-center text-lg" placeholder="‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏±‡∏ï‡∏£ ‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà (‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)" oninput="performCheck()" autofocus>
                    <button onclick="performCheck()" class="hidden md:block bg-amber-600 text-white px-6 py-3 rounded-lg font-bold w-full md:w-auto">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</button>
                </div>
                <div id="check-result" class="hidden flex flex-col gap-5 fade-in">
                    <div class="bg-gradient-to-br from-slate-800 to-slate-900 p-6 rounded-2xl border border-red-900/50 flex justify-between items-center shadow-lg">
                        <div><h2 id="check-name" class="text-3xl font-bold text-white tracking-wide">-</h2><p id="check-class" class="text-amber-400 text-lg font-semibold mt-1">-</p></div>
                        <div class="text-right bg-slate-900/50 p-3 rounded-xl border border-slate-700"><p class="text-xs text-slate-400">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏ß‡∏°</p><p id="check-total-score" class="text-4xl font-bold text-green-400">0</p></div>
                    </div>
                    <div class="overflow-hidden bg-slate-800/40 rounded-xl border border-slate-700">
                        <table class="min-w-full text-sm text-slate-300"><thead class="bg-slate-900 text-xs uppercase font-semibold text-slate-400"><tr><th class="px-4 py-3 text-left">‡∏á‡∏≤‡∏ô</th><th class="px-4 py-3 text-right">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th></tr></thead><tbody id="check-table-body" class="divide-y divide-slate-700/50"></tbody></table>
                    </div>
                </div>
            </section>

            <section id="admin-panel-report" class="admin-panel hidden glass rounded-2xl p-5 flex flex-col gap-6">
                 <div class="flex items-center justify-between"><h3 class="text-lg font-bold text-white">‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h3><button onclick="exportGradeCSV()" class="bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded-lg text-sm font-bold flex gap-2"><i class="fa-solid fa-file-csv"></i> CSV</button></div>
                 <div class="bg-slate-800/50 p-4 rounded-xl border border-slate-700"><label class="text-xs text-slate-400 block mb-1">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á</label><select id="report-class" class="w-full bg-slate-900 border border-slate-600 rounded px-3 py-2 text-sm text-white"></select></div>
                 <div class="overflow-x-auto bg-slate-800/40 rounded-xl border border-slate-700"><table class="min-w-full text-sm text-slate-300"><thead class="bg-slate-900 text-xs uppercase font-semibold text-slate-400"><tr><th class="px-2 py-3 text-center">#</th><th class="px-2 py-3 text-left min-w-[150px]">‡∏ä‡∏∑‡πà‡∏≠</th><th class="px-1 py-3 text-center text-amber-500">‡∏ö‡∏ó1</th><th class="px-1 py-3 text-center text-amber-500">‡∏ö‡∏ó2</th><th class="px-1 py-3 text-center text-amber-500">‡∏ö‡∏ó3</th><th class="px-1 py-3 text-center text-amber-500">‡∏ö‡∏ó4</th><th class="px-1 py-3 text-center text-amber-500">‡∏ö‡∏ó5</th><th class="px-1 py-3 text-center text-amber-500">‡∏ö‡∏ó6</th><th class="px-1 py-3 text-center text-blue-400">‡∏Å‡∏•‡∏≤‡∏á</th><th class="px-1 py-3 text-center text-purple-400">‡∏õ‡∏•‡∏≤‡∏¢</th><th class="px-2 py-3 text-center text-white font-bold border-l border-slate-700">‡∏£‡∏ß‡∏°</th><th class="px-2 py-3 text-center">‡πÄ‡∏Å‡∏£‡∏î</th><th class="px-2 py-3 text-center text-pink-400 border-l border-slate-700">‡∏û‡∏¥‡πÄ‡∏®‡∏©</th></tr></thead><tbody id="report-table-body" class="divide-y divide-slate-700/50"></tbody></table></div>
            </section>

            <section id="admin-panel-attreport" class="admin-panel hidden glass rounded-2xl p-5 flex flex-col gap-5">
                <div class="flex flex-col md:flex-row justify-between items-end gap-4 bg-slate-800/50 p-4 rounded-xl border border-slate-700">
                    <div class="flex gap-3 items-end w-full md:w-auto">
                        <div><label class="text-xs text-slate-400 block mb-1">‡∏´‡πâ‡∏≠‡∏á</label><select id="report-att-class" class="bg-slate-900 border border-slate-600 rounded px-3 py-2 text-sm text-white min-w-[150px]"></select></div>
                        <div><label class="text-xs text-slate-400 block mb-1">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</label><input id="report-att-month" type="month" class="bg-slate-900 border border-slate-600 rounded px-3 py-2 text-sm text-white"></div>
                        <button onclick="renderAttReportMatrix()" class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded text-sm font-bold h-[38px]">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
                    </div>
                    <button onclick="exportMatrixCSV()" class="bg-green-700 hover:bg-green-600 text-white px-4 py-2 rounded text-sm font-bold flex items-center gap-2 h-[38px]"><i class="fa-solid fa-file-csv"></i> Export CSV</button>
                </div>
                <div class="overflow-x-auto bg-slate-900 border border-slate-700 rounded-xl shadow-inner"><table class="min-w-full text-sm text-left text-slate-300 whitespace-nowrap" id="att-matrix-table"><thead class="text-xs uppercase bg-slate-800 text-slate-400 sticky top-0 z-10 shadow"><tr id="att-matrix-header"></tr></thead><tbody id="att-matrix-body" class="divide-y divide-slate-700/50"></tbody></table></div>
            </section>

            <section id="admin-panel-material" class="admin-panel hidden glass rounded-2xl p-5 flex flex-col gap-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="md:col-span-1 bg-slate-800/50 p-4 rounded-xl border border-slate-700 h-fit">
                        <h3 class="font-bold text-white mb-4 border-b border-slate-600 pb-2">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
                        <form id="form-material" class="space-y-3">
                            <div><label class="text-xs text-slate-400">‡∏ß‡∏¥‡∏ä‡∏≤</label><select id="mat-subject" class="w-full bg-slate-900 border border-slate-600 rounded px-2 py-2 text-sm text-white" required></select></div>
                            <div><label class="text-xs text-slate-400">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ / ‡∏ö‡∏ó‡∏ó‡∏µ‡πà</label><input id="mat-title" type="text" class="w-full bg-slate-900 border border-slate-600 rounded px-2 py-2 text-sm text-white" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ö‡∏ó‡∏ó‡∏µ‡πà 1 ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡πÉ‡∏´‡∏°‡πà" required></div>
                            <div><label class="text-xs text-slate-400">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label><select id="mat-type" class="w-full bg-slate-900 border border-slate-600 rounded px-2 py-2 text-sm text-white"><option value="pdf">‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ (PDF/Slide)</option><option value="video">‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ (YouTube)</option><option value="link">‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå</option></select></div>
                            <div><label class="text-xs text-slate-400">‡∏•‡∏¥‡∏á‡∏Å‡πå (URL)</label><input id="mat-link" type="url" class="w-full bg-slate-900 border border-slate-600 rounded px-2 py-2 text-blue-300 text-sm" placeholder="https://..." required></div>
                            <div><label class="text-xs text-slate-400">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (Optional)</label><textarea id="mat-desc" class="w-full bg-slate-900 border border-slate-600 rounded px-2 py-2 text-sm text-white h-16 resize-none"></textarea></div>
                            <button type="submit" class="w-full bg-amber-600 hover:bg-amber-500 text-white py-2 rounded font-bold shadow-lg mt-2">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤</button>
                        </form>
                    </div>
                    <div class="md:col-span-2 flex flex-col gap-4">
                        <div class="flex justify-between items-center"><h3 class="font-bold text-slate-300">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà</h3><select id="mat-filter-subject" class="bg-slate-900 border border-slate-600 rounded px-2 py-1 text-xs text-white" onchange="renderAdminMaterials()"></select></div>
                        <div id="admin-mat-list" class="grid grid-cols-1 gap-3 overflow-y-auto max-h-[600px] pr-2"></div>
                    </div>
                </div>
            </section>
        </div>
      </div>

      <div id="section-student" class="hidden flex flex-col gap-5">
         <div id="student-login-wrapper" class="flex flex-col items-center justify-center py-10 gap-6">
            <div class="glass p-8 rounded-2xl w-full max-w-sm shadow-xl relative flex flex-col items-center border border-slate-700">
                <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 to-cyan-400"></div>
                <img src="https://img2.pic.in.th/pic/Logoc404dc85753b800c.png" alt="Logo" class="w-32 h-32 object-contain mb-6">
                <h2 class="text-xl font-bold text-white mb-6">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
                <div class="w-full space-y-4">
                    <input id="student-login-id" type="text" class="w-full bg-slate-900 border-2 border-slate-600 rounded-xl px-4 py-3 text-center text-white text-lg outline-none" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô">
                    <button onclick="handleStudentLogin()" class="w-full py-3 rounded-lg bg-blue-700 hover:bg-blue-600 text-white font-bold shadow-lg">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                </div>
                <div id="data-status" class="mt-4 text-xs text-slate-500 text-center">
                  <i class="fa-solid fa-circle-notch fa-spin mr-1"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...
                </div>
            </div>
        </div>
          <div id="student-dashboard" class="hidden flex flex-col gap-6">
               <div class="glass p-6 rounded-2xl flex flex-col md:flex-row items-center gap-6 border border-slate-700 bg-gradient-to-br from-slate-900 to-slate-800">
                   <div class="h-20 w-20 rounded-full bg-slate-700 flex items-center justify-center text-3xl border-2 border-blue-500 shadow-lg">üéì</div>
                   <div class="text-center md:text-left">
                       <h2 id="std-dash-name" class="text-2xl font-bold text-white mb-1">-</h2>
                       <div class="flex gap-3 justify-center md:justify-start text-sm text-slate-400">
                           <span id="std-dash-id" class="bg-slate-800 px-2 py-1 rounded">ID: -</span>
                           <span id="std-dash-class" class="bg-slate-800 px-2 py-1 rounded text-blue-300">Class: -</span>
                       </div>
                   </div>
                   <button onclick="logoutStudent()" class="absolute top-4 right-4 text-slate-500 hover:text-white"><i class="fa-solid fa-right-from-bracket"></i></button>
               </div>
               <div id="std-subjects-container" class="flex flex-col gap-6"></div>
               <div class="glass p-5 rounded-2xl border border-slate-700">
                   <h3 class="font-bold text-white mb-4 border-b border-slate-700 pb-2">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤)</h3>
                   <div class="overflow-y-auto max-h-60"><table class="w-full text-sm text-left text-slate-300"><thead class="text-xs uppercase bg-slate-800 text-slate-400"><tr><th class="px-3 py-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th class="px-3 py-2 text-center">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th></tr></thead><tbody id="std-att-body" class="divide-y divide-slate-700/50"></tbody></table></div>
               </div>
          </div>
      </div>

     </div>
    </main>
    
    <div id="score-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-slate-950/90 backdrop-blur-sm">
        <div class="bg-slate-900 border border-slate-600 rounded-2xl p-6 w-full max-w-xs shadow-2xl">
            <h3 class="text-lg font-bold text-white mb-4 text-center">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h3>
            <p class="text-slate-400 text-sm mb-1 text-center" id="modal-task-name"></p>
            <p class="text-amber-400 text-lg font-bold mb-4 text-center" id="modal-student-name"></p>
            <div class="relative"><input id="modal-score-input" type="number" class="w-full bg-slate-950 border-2 border-red-500 rounded-xl px-4 py-4 text-3xl text-center text-white font-bold focus:outline-none"><span class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-500 text-sm">/ <span id="modal-max-score"></span></span></div>
            <div class="grid grid-cols-2 gap-3 mt-6"><button onclick="document.getElementById('score-modal').classList.add('hidden')" class="py-2 rounded-lg bg-slate-800 text-slate-300">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button><button id="btn-modal-save" class="py-2 rounded-lg bg-red-700 text-white font-bold">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å (Enter)</button></div>
        </div>
    </div>

    <div id="submit-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-slate-950/90 backdrop-blur-sm">
        <div class="bg-slate-900 border border-slate-600 rounded-2xl p-6 w-full max-w-sm shadow-2xl">
            <h3 class="text-lg font-bold text-white mb-2"><i class="fa-solid fa-paper-plane mr-2 text-blue-400"></i>‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô</h3>
            <p class="text-sm text-slate-400 mb-4" id="submit-modal-title"></p>
            <form id="form-submit-work" class="space-y-4">
                <input type="hidden" id="submit-task-id">
                <input type="hidden" id="submit-student-id">
                <div>
                    <label class="text-xs text-slate-400 mb-1 block">‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏á‡∏≤‡∏ô (Google Drive, YouTube, PDF, etc.)</label>
                    <input id="submit-link-input" type="url" class="w-full bg-slate-800 border border-slate-600 rounded-lg px-3 py-2 text-white text-sm focus:border-blue-500 outline-none" placeholder="https://..." required>
                </div>
                <div class="flex justify-end gap-2 pt-2">
                    <button type="button" onclick="document.getElementById('submit-modal').classList.add('hidden')" class="px-4 py-2 rounded bg-slate-700 text-slate-300 text-sm">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button type="submit" class="px-4 py-2 rounded bg-blue-600 text-white text-sm font-bold">‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô</button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="toast-notification" class="fixed bottom-6 left-1/2 -translate-x-1/2 bg-green-600 text-white px-6 py-3 rounded-full shadow-2xl z-50 flex items-center gap-2 translate-y-20 opacity-0 font-bold border border-green-400"><i class="fa-solid fa-circle-check text-xl"></i><span id="toast-message">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</span></div>
   </div>
  </div>

  <script>
      // ***********************************************
      // CONFIGURATION
      // ***********************************************
      const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwQNjMSE06u5xO4dtyipa5P-YzoaicppubdwlUgMpaX4L4TUjk3-xY2PRnzhS42AxZe/exec"; 
      // ***********************************************

      let dataState = { subjects:[], classes:[], students:[], tasks:[], scores:[], attendance:[], materials:[], submissions:[] };
      let attMode = null; 
      let scoreMode = 'manual'; 

      window.addEventListener('DOMContentLoaded', () => {
          const bangkokDate = getThaiDateISO();
          document.getElementById('att-date-input').value = bangkokDate;
          document.getElementById('report-att-month').value = bangkokDate.slice(0, 7);
          renderScoreButtons(); 
          initEventListeners();
          const savedSession = localStorage.getItem('wany_admin_session');
          if(savedSession === 'active') { showAdminPanel(true); } else { syncData(); }
      });

      async function syncData() {
          const statusEl = document.getElementById('data-status');
          if(statusEl) statusEl.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin text-yellow-500"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...';
          try {
             const res = await fetch(`${GOOGLE_SCRIPT_URL}?action=getData`);
             const json = await res.json();
             if(json) { 
                 dataState = json; 
                 refreshUI(); 
                 updateInboxBadge();
                 if(statusEl) statusEl.innerHTML = `<span class="text-green-400"><i class="fa-solid fa-wifi"></i> ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå | ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ${json.students.length} ‡∏Ñ‡∏ô</span>`;
             }
          } catch(e) { 
              console.error(e); 
              showToast("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Server ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ", "bg-red-600");
          }
      }

      function refreshUI() {
          refreshDropdowns();
          const taskClass = document.getElementById('task-class').value;
          if(taskClass) renderTaskList(taskClass);
          if(!document.getElementById('admin-panel-scan').classList.contains('hidden')) { updateScanTaskDropdown(); renderScoreRoster(); }
          if(!document.getElementById('admin-panel-attendance').classList.contains('hidden')) { renderLiveRoster(); }
          if(!document.getElementById('admin-panel-material').classList.contains('hidden')) { renderAdminMaterials(); }
          if(!document.getElementById('admin-panel-homework').classList.contains('hidden')) { renderIncomingSubmissions(); }
      }

      async function saveAndRefresh(payload) {
          updateLocalState(payload);
          refreshSpecificUI(payload);
          try { await fetch(GOOGLE_SCRIPT_URL, { method:'POST', body:JSON.stringify(payload) }); } 
          catch(e) { console.error("Save failed", e); alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß!"); }
      }

      function updateLocalState(p) {
          if(p.action === 'addSubject') dataState.subjects.push({id:p.id, name:p.name});
          if(p.action === 'addClass') dataState.classes.push({id:p.id, name:p.name, subjectId:p.subjectId});
          if(p.action === 'addStudent') dataState.students.push({id:p.id, classId:p.classId, no:p.no, code:p.code, name:p.name});
          // Optimistic addTask (Multiple)
          if(p.action === 'addTask') {
             // Logic moved to event listener to handle loop
          }
          if(p.action === 'addScore') {
              const idx = dataState.scores.findIndex(s => s.studentId == p.studentId && s.taskId == p.taskId);
              if(idx >= 0) dataState.scores[idx].score = p.score;
              else dataState.scores.push({studentId:p.studentId, taskId:p.taskId, score:p.score});
          }
          if(p.action === 'submitTask') {
              const idx = dataState.submissions.findIndex(s => s.studentId == p.studentId && s.taskId == p.taskId);
              if(idx >= 0) { dataState.submissions[idx].link = p.link; dataState.submissions[idx].timestampISO = new Date().toISOString(); }
              else dataState.submissions.push({taskId:p.taskId, studentId:p.studentId, link:p.link, timestampISO: new Date().toISOString()});
          }
          if(p.action === 'addAttendance') {
              const idx = dataState.attendance.findIndex(a => a.studentId == p.studentId && formatThaiDate(a.date) == formatThaiDate(p.date));
              if(idx >= 0) dataState.attendance[idx].status = p.status;
              else dataState.attendance.push({studentId:p.studentId, classId:p.classId, date:p.date, status:p.status});
          }
          if(p.action === 'addMaterial') dataState.materials.push({id: p.id, subjectId: p.subjectId, title: p.title, link: p.link, type: p.type, desc: p.desc});
          if(p.action === 'deleteMaterial') dataState.materials = dataState.materials.filter(m => m.id != p.id);
          
          updateInboxBadge();
      }

      function refreshSpecificUI(p) {
          if(['addSubject','addClass'].includes(p.action)) refreshDropdowns();
          if(p.action === 'addTask') { updateScanTaskDropdown(); }
          if(p.action === 'addScore') { renderScoreRoster(); renderIncomingSubmissions(); }
          if(p.action === 'addMaterial' || p.action === 'deleteMaterial') { renderAdminMaterials(); }
          if(p.action === 'submitTask') { /* Refresh Student UI handled in function */ }
      }

      // --- UI HELPERS ---
      function showAdminPanel(isAutoLogin = false) {
          document.getElementById('admin-login-wrapper').classList.add('hidden');
          document.getElementById('admin-content-wrapper').classList.remove('hidden');
          document.getElementById('tab-btn-admin').className="px-5 py-2 rounded-full text-sm font-semibold text-white bg-red-700 shadow-lg transition-all";
          document.getElementById('tab-btn-student').className="px-5 py-2 rounded-full text-sm font-semibold text-slate-400 hover:text-white hover:bg-slate-800 transition-all";
          
          localStorage.setItem('wany_admin_session', 'active');
          refreshUI(); 
          let currentPanel = 'attendance';
          document.querySelectorAll('.admin-panel').forEach(p => { if(!p.classList.contains('hidden')) currentPanel = p.id.replace('admin-panel-', ''); });
          switchAdminSubTab(currentPanel);
          if(!isAutoLogin) syncData(); 
      }
      function handleAdminLogout() {
          if(!confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?")) return;
          localStorage.removeItem('wany_admin_session');
          location.reload();
      }
      function refreshDropdowns() {
          const populate = (id, arr) => {
              const el = document.getElementById(id); if(!el) return;
              el.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>';
              [...arr].sort((a,b)=>a.name.localeCompare(b.name)).forEach(i=>{ const opt = document.createElement('option'); opt.value=i.id; opt.textContent=i.name; el.appendChild(opt); });
          };
          populate('class-subject-ref', dataState.subjects);
          populate('student-class', dataState.classes);
          populate('scan-class-select', dataState.classes);
          populate('att-class-select', dataState.classes);
          populate('check-class-filter', dataState.classes);
          populate('report-class', dataState.classes);
          populate('report-att-class', dataState.classes);
          populate('mat-subject', dataState.subjects);
          populate('mat-filter-subject', dataState.subjects);
          populate('task-subject-filter', dataState.subjects); 
      }

      function initEventListeners() {
          document.getElementById('admin-login-form').onsubmit = (e) => { e.preventDefault(); if(document.getElementById('admin-username').value === 'admin' && document.getElementById('admin-password').value === 'admin290936') { showAdminPanel(); } else alert("‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏¥‡∏î"); };
          document.getElementById('form-subject').onsubmit = (e) => { e.preventDefault(); saveAndRefresh({ action:'addSubject', id:Date.now(), name:document.getElementById('subject-name').value }); e.target.reset(); alert("‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏¥‡∏ä‡∏≤‡πÅ‡∏•‡πâ‡∏ß"); };
          document.getElementById('form-class').onsubmit = (e) => { e.preventDefault(); saveAndRefresh({ action:'addClass', id:Date.now(), name:document.getElementById('class-name').value, subjectId:document.getElementById('class-subject-ref').value }); e.target.reset(); alert("‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß"); };
          document.getElementById('form-student').onsubmit = (e) => { e.preventDefault(); saveAndRefresh({ action: 'addStudent', id: Date.now(), classId: document.getElementById('student-class').value, no: document.getElementById('student-no').value, code: document.getElementById('student-id').value, name: document.getElementById('student-name').value }); e.target.reset(); alert("‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß"); };
          
          // [NEW] Multi-class Task Add
          document.getElementById('form-task').onsubmit = (e) => { 
              e.preventDefault(); 
              const checkboxes = document.querySelectorAll('input[name="selectedClasses"]:checked');
              const selectedClassIds = Array.from(checkboxes).map(cb => cb.value);
              if (selectedClassIds.length === 0) { alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏´‡πâ‡∏≠‡∏á"); return; }
              const subId = document.getElementById('task-subject-filter').value;
              const cat = document.getElementById('task-category').value;
              const baseId = Date.now();
              const payload = { 
                  action: 'addTask', id: baseId, classIds: selectedClassIds, subjectId: subId, category: cat, 
                  chapter: cat === 'accum' ? document.getElementById('task-chapter').value : 0,
                  name: document.getElementById('task-name').value, maxScore: document.getElementById('task-max').value, 
                  dueDateISO: getThaiDateISO(), description: document.getElementById('task-desc').value, fileLink: document.getElementById('task-link').value 
              };
              selectedClassIds.forEach((cid, index) => {
                  dataState.tasks.push({ id: baseId + index, classId: cid, subjectId: subId, category: payload.category, chapter: payload.chapter, name: payload.name, maxScore: payload.maxScore, dueDateISO: payload.dueDateISO, description: payload.description, fileLink: payload.fileLink });
              });
              saveAndRefresh(payload); 
              e.target.reset(); document.getElementById('task-class-checkboxes').innerHTML = '<div class="text-xs text-slate-500 text-center col-span-2">- ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô -</div>';
              showToast(`‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ (${selectedClassIds.length} ‡∏´‡πâ‡∏≠‡∏á)`);
          };

          // [NEW] Form Material
          document.getElementById('form-material').onsubmit = (e) => {
              e.preventDefault();
              saveAndRefresh({ action: 'addMaterial', id: Date.now(), subjectId: document.getElementById('mat-subject').value, title: document.getElementById('mat-title').value, type: document.getElementById('mat-type').value, link: document.getElementById('mat-link').value, desc: document.getElementById('mat-desc').value });
              e.target.reset(); showToast("‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
          };
          
          // [NEW] Form Student Submit
          document.getElementById('form-submit-work').onsubmit = (e) => {
              e.preventDefault();
              const tid = document.getElementById('submit-task-id').value;
              const sid = document.getElementById('submit-student-id').value;
              const link = document.getElementById('submit-link-input').value;
              saveAndRefresh({ action: 'submitTask', taskId: tid, studentId: sid, link: link });
              document.getElementById('submit-modal').classList.add('hidden');
              showToast("‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
              // Re-render Student UI if visible
              if(!document.getElementById('student-dashboard').classList.contains('hidden')) {
                  setTimeout(handleStudentLogin, 100); 
              }
          };

          document.getElementById('task-category').onchange = (e) => { if(e.target.value === 'accum') document.getElementById('chapter-wrapper').classList.remove('hidden'); else document.getElementById('chapter-wrapper').classList.add('hidden'); };
          const scanInp = document.getElementById('scan-score-input');
          scanInp.onkeydown = (e) => { if(e.key==='Enter'){ handleScoreScan(scanInp.value.trim()); scanInp.value=''; } };
          document.getElementById('scan-class-select').onchange = (e) => { updateScanTaskDropdown(); renderScoreRoster(); };
          document.getElementById('scan-task-select').onchange = renderScoreRoster;
          document.getElementById('modal-score-input').onkeydown = (e) => { if (e.key === 'Enter') saveScoreFromModal(); };
          document.getElementById('btn-modal-save').onclick = saveScoreFromModal;
          document.getElementById('att-class-select').onchange = renderLiveRoster;
          document.getElementById('att-date-input').onchange = renderLiveRoster;
          const attInp = document.getElementById('att-scan-input');
          attInp.onkeydown = (e) => { if(e.key==='Enter'){ handleAttScan(attInp.value.trim()); attInp.value=''; } };
          document.getElementById('report-class').onchange = renderGradeReport;
          document.getElementById('student-login-id').onkeydown = (e) => { if(e.key === 'Enter') handleStudentLogin(); };
      }

      // --- NEW FUNCTION: Multi-Class Task Checkboxes ---
      window.renderTaskClassCheckboxes = function() {
          const subId = document.getElementById('task-subject-filter').value;
          const container = document.getElementById('task-class-checkboxes');
          container.innerHTML = '';
          if (!subId) { container.innerHTML = '<div class="text-xs text-slate-500 text-center col-span-2">- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡πà‡∏≠‡∏ô -</div>'; return; }
          const classes = dataState.classes.filter(c => c.subjectId == subId);
          if (classes.length === 0) { container.innerHTML = '<div class="text-xs text-red-400 text-center col-span-2">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤‡∏ô‡∏µ‡πâ</div>'; return; }
          classes.forEach(c => {
              const wrapper = document.createElement('label');
              wrapper.className = "flex items-center space-x-2 bg-slate-800 p-2 rounded cursor-pointer hover:bg-slate-700 border border-slate-700";
              wrapper.innerHTML = `<input type="checkbox" name="selectedClasses" value="${c.id}" class="accent-amber-500 w-4 h-4 rounded"><span class="text-xs text-white font-bold">${c.name}</span>`;
              container.appendChild(wrapper);
          });
      };

      // --- INBOX / GRADING LOGIC ---
      function updateInboxBadge() {
           let count = 0;
           dataState.submissions.forEach(sub => {
               const hasScore = dataState.scores.some(sc => sc.taskId == sub.taskId && sc.studentId == sub.studentId);
               if(!hasScore) count++;
           });
           const badge = document.getElementById('badge-homework');
           if(count > 0) { badge.classList.remove('hidden'); badge.textContent = count > 99 ? '99+' : count; } 
           else { badge.classList.add('hidden'); }
      }

      window.renderIncomingSubmissions = function() {
          const container = document.getElementById('incoming-list');
          container.innerHTML = '';
          const pendingSubs = dataState.submissions.filter(sub => {
               return !dataState.scores.some(sc => sc.taskId == sub.taskId && sc.studentId == sub.studentId);
          });

          if(pendingSubs.length === 0) { container.innerHTML = '<div class="text-center text-slate-500 py-10">‡πÑ‡∏°‡πà‡∏°‡∏∑‡∏≠‡∏á‡∏≤‡∏ô‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à</div>'; return; }

          pendingSubs.sort((a,b) => new Date(b.timestampISO) - new Date(a.timestampISO)); 

          pendingSubs.forEach(sub => {
              const task = dataState.tasks.find(t => t.id == sub.taskId);
              const student = dataState.students.find(s => s.id == sub.studentId);
              if(!task || !student) return;
              
              const className = dataState.classes.find(c => c.id == student.classId)?.name || '-';

              const div = document.createElement('div');
              div.className = "bg-slate-800 p-4 rounded-xl border border-slate-700 flex flex-col md:flex-row gap-4 items-center";
              div.innerHTML = `
                  <div class="flex-1 w-full">
                      <div class="flex items-center gap-2 mb-1">
                          <span class="bg-blue-900 text-blue-300 text-[10px] px-2 py-0.5 rounded font-bold">${className}</span>
                          <span class="text-xs text-slate-400">${formatThaiDate(sub.timestampISO)}</span>
                      </div>
                      <h4 class="font-bold text-white text-sm">${task.name} <span class="text-slate-500 text-xs">(${task.maxScore} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)</span></h4>
                      <p class="text-xs text-amber-400 font-bold mb-2">${student.name} (‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà ${student.no})</p>
                      <a href="${sub.link}" target="_blank" class="text-blue-400 text-xs hover:underline flex items-center gap-1"><i class="fa-solid fa-up-right-from-square"></i> ‡πÄ‡∏õ‡∏¥‡∏î‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏á‡∏≤‡∏ô</a>
                  </div>
                  <div class="flex items-center gap-2 w-full md:w-auto bg-slate-900/50 p-2 rounded-lg border border-slate-700">
                      <input id="grade-input-${sub.id}" type="number" class="w-16 bg-slate-800 border border-slate-600 rounded px-2 py-1 text-center text-white font-bold" placeholder="0">
                      <span class="text-slate-500 text-xs">/${task.maxScore}</span>
                      <button onclick="submitGrade('${sub.id}', '${sub.studentId}', '${sub.taskId}', ${task.maxScore})" class="bg-green-600 hover:bg-green-500 text-white px-3 py-1 rounded text-xs font-bold ml-2">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                  </div>
              `;
              container.appendChild(div);
          });
      };

      window.submitGrade = function(subId, sid, tid, max) {
          const val = document.getElementById(`grade-input-${subId}`).value;
          if(val === '') return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô");
          if(Number(val) > Number(max)) return alert("‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏ï‡πá‡∏°");
          
          saveAndRefresh({ action:'addScore', studentId: sid, taskId: tid, score: val });
          showToast("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
          renderIncomingSubmissions();
      };

      // --- EXISTING UTILS (FIXED SYNTAX) ---
      function updateScanTaskDropdown() {
          const cid = document.getElementById('scan-class-select').value;
          const el = document.getElementById('scan-task-select'); 
          el.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏á‡∏≤‡∏ô --</option>';
          dataState.tasks.filter(t => t.classId == cid).reverse().forEach(t => { 
              const opt = document.createElement('option'); 
              opt.value = t.id; 
              opt.textContent = `${t.name} (${t.maxScore})`; 
              el.appendChild(opt); 
          });
      }
      function handleScoreScan(code) {
          const tid = document.getElementById('scan-task-select').value; if(!tid) return alert("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏á‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô");
          const s = dataState.students.find(x => x.code == code); const t = dataState.tasks.find(x => x.id == tid); if(!s || !t) return alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");
          if(scoreMode === 'manual') openScoreModalForStudent(s, t); else { if(Number(scoreMode) > Number(t.maxScore)) return alert("‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏ï‡πá‡∏°"); saveScoreDirectly(s, t, scoreMode); }
          document.getElementById('scan-score-input').value = '';
      }
      function saveScoreDirectly(s, t, val) { saveAndRefresh({ action:'addScore', studentId: s.id, taskId: t.id, score: val }); showToast(`‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ${s.no}.${s.name} : ${val} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô`); }
      function openScoreModalForStudent(s, t) { window.pendingScore = { s, t }; document.getElementById('score-modal').classList.remove('hidden'); document.getElementById('modal-task-name').textContent = t.name; document.getElementById('modal-student-name').textContent = `‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà ${s.no} ${s.name}`; document.getElementById('modal-max-score').textContent = t.maxScore; const exist = dataState.scores.find(x => x.studentId == s.id && x.taskId == t.id); const inp = document.getElementById('modal-score-input'); inp.value = exist ? exist.score : t.maxScore; setTimeout(() => inp.select(), 100); }
      function saveScoreFromModal() { const val = document.getElementById('modal-score-input').value; const { s, t } = window.pendingScore; if(Number(val) > 30) return alert("max 30"); if(Number(val) > Number(t.maxScore)) return alert("‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏ï‡πá‡∏°"); saveScoreDirectly(s, t, val); document.getElementById('score-modal').classList.add('hidden'); }
      
      window.renderScoreRoster = function() { 
          const cid = document.getElementById('scan-class-select').value; 
          const taskId = document.getElementById('scan-task-select').value; 
          const div = document.getElementById('score-roster-grid'); 
          div.innerHTML = ''; 
          if(!cid || !taskId) { div.innerHTML = '<div class="col-span-full text-center text-slate-500 py-10">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏á‡∏≤‡∏ô...</div>'; return; } 
          const students = dataState.students.filter(s => s.classId == cid).sort((a,b)=>(Number(a.no)||0)-(Number(b.no)||0)); 
          const task = dataState.tasks.find(t => t.id == taskId); 
          students.forEach(s => { 
              const scoreLog = dataState.scores.find(sc => sc.studentId == s.id && sc.taskId == taskId); 
              const hasScore = !!scoreLog; 
              const val = hasScore ? scoreLog.score : '-'; 
              const el = document.createElement('div'); 
              el.className = `status-box ${hasScore ? 'status-done' : 'status-none'} p-2 rounded-lg flex flex-col items-center justify-center cursor-pointer select-none border border-slate-700`; 
              el.onclick = () => openScoreModalForStudent(s, task); 
              // Fixed Syntax Here
              el.innerHTML = `<div class="text-xs opacity-70 mb-1">No. ${s.no||'-'}</div><div class="font-bold text-center text-xs truncate w-full px-1">${s.name}</div><div class="text-lg font-bold mt-1 text-white">${val} <span class="text-[10px] text-slate-400 font-normal">/${task.maxScore}</span></div>`; 
              div.appendChild(el); 
          }); 
      };
      
      function handleAttScan(code) { if(!attMode) return; const cid = document.getElementById('att-class-select').value; const s = dataState.students.find(x => x.code == code && x.classId == cid); if(!s) return alert("‡πÑ‡∏°‡πà‡∏û‡∏ö/‡∏ú‡∏¥‡∏î‡∏´‡πâ‡∏≠‡∏á"); processAtt(s); }
      function manualAtt(s) { if(!attMode) return alert("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡πà‡∏≠‡∏ô"); processAtt(s); }
      function processAtt(s) { 
          const date = document.getElementById('att-date-input').value; 
          const card = document.getElementById(`card-${s.id}`); 
          if(card) { 
              card.className = `status-box status-${attMode} p-3 rounded-lg flex flex-col items-center justify-center cursor-pointer select-none transition-transform scale-105`; 
              card.querySelector('.status-text').textContent = attMode; 
              setTimeout(()=>card.classList.remove('scale-105'), 200); 
          } 
          saveAndRefresh({ action:'addAttendance', studentId:s.id, classId:s.classId, date:date, status:attMode }); 
      }
      
      function renderLiveRoster() { 
          const cid = document.getElementById('att-class-select').value; 
          const date = document.getElementById('att-date-input').value; 
          const div = document.getElementById('att-roster-grid'); 
          div.innerHTML = ''; 
          if(!cid) return; 
          const list = dataState.students.filter(s=>s.classId==cid).sort((a,b)=>(Number(a.no)||0)-(Number(b.no)||0)); 
          list.forEach(s => { 
              const log = dataState.attendance.find(a => a.studentId==s.id && formatThaiDate(a.date) == formatThaiDate(date)); 
              const st = log ? log.status : 'none'; 
              const el = document.createElement('div'); 
              el.id = `card-${s.id}`; 
              el.className = `status-box status-${st} p-3 rounded-lg flex flex-col items-center justify-center cursor-pointer select-none`; 
              el.onclick = () => manualAtt(s); 
              // Fixed Syntax Here
              el.innerHTML = `<div class="text-xs opacity-70 mb-1">No. ${s.no||'-'}</div><div class="font-bold text-center text-sm">${s.name}</div><div class="text-[10px] mt-1 opacity-80 status-text">${st==='none'?'‡∏£‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ':st}</div>`; 
              div.appendChild(el); 
          }); 
      }
      
      // [SAME] Report functions
      window.renderGradeReport = function() { const cid = document.getElementById('report-class').value; const tbody = document.getElementById('report-table-body'); tbody.innerHTML = ''; if(!cid) return; const list = dataState.students.filter(s => s.classId == cid).sort((a,b)=>(Number(a.no)||0)-(Number(b.no)||0)); const tasks = dataState.tasks.filter(t => t.classId == cid); list.forEach((s, idx) => { let chapScores = []; for(let i=1; i<=6; i++) { const cTasks = tasks.filter(t => t.category === 'accum' && t.chapter == i); let earn=0, max=0; if(cTasks.length > 0) { cTasks.forEach(t => { const sc = dataState.scores.find(x => x.studentId == s.id && x.taskId == t.id); earn += sc ? Number(sc.score) : 0; max += Number(t.maxScore); }); chapScores.push(max > 0 ? Math.round((earn/max)*10) : 0); } else { chapScores.push(0); } } const getSum = (cat) => { let sum = 0; tasks.filter(t => t.category === cat).forEach(t => { const sc = dataState.scores.find(x => x.studentId == s.id && x.taskId == t.id); sum += sc ? Number(sc.score) : 0; }); return sum; }; const mid = getSum('midterm'); const final = getSum('final'); const special = getSum('special'); const total = chapScores.reduce((a,b)=>a+b, 0) + mid + final; let rowHtml = `<td class="text-center text-slate-500">${s.no||idx+1}</td><td class="px-2 py-3 text-white text-xs">${s.name}</td>`; chapScores.forEach(c => rowHtml += `<td class="text-center text-amber-500">${c}</td>`); rowHtml += `<td class="text-center text-blue-400">${mid}</td><td class="text-center text-purple-400">${final}</td><td class="text-center font-bold text-white bg-slate-800/20">${total}</td><td class="text-center text-slate-300 font-bold">${calGrade(total)}</td><td class="text-center text-pink-400 bg-pink-900/10">${special}</td>`; const tr = document.createElement('tr'); tr.className = "hover:bg-slate-800/30"; tr.innerHTML = rowHtml; tbody.appendChild(tr); }); };
      function calGrade(s) { if(s>=80) return 4; if(s>=75) return 3.5; if(s>=70) return 3; if(s>=65) return 2.5; if(s>=60) return 2; if(s>=55) return 1.5; if(s>=50) return 1; return 0; }
      window.exportGradeCSV = function() { const rows = document.querySelectorAll('#report-table-body tr'); let csv = "\uFEFFNo,Name,Ch1,Ch2,Ch3,Ch4,Ch5,Ch6,Mid,Final,Total,Grade,Special\n"; rows.forEach(r => { csv += Array.from(r.querySelectorAll('td')).map(d=>`"${d.innerText}"`).join(',') + "\n"; }); downloadCSV(csv, "grade_report.csv"); };
      window.renderAttReportMatrix = function() { const cid = document.getElementById('report-att-class').value; const month = document.getElementById('report-att-month').value; const tbody = document.getElementById('att-matrix-body'); const thead = document.getElementById('att-matrix-header'); tbody.innerHTML=''; thead.innerHTML=''; if(!cid||!month) return; let logs = dataState.attendance.filter(a => a.classId == cid && a.date.startsWith(month)); let dates = [...new Set(logs.map(a=>formatThaiDate(a.date)))].sort(); window.curAttDates = dates; let h = `<th class="px-4 py-3 bg-slate-800 sticky left-0 z-20 border-r border-slate-700 w-10 text-center">#</th><th class="px-4 py-3 bg-slate-800 sticky left-[40px] z-20 border-r border-slate-700 min-w-[150px]">‡∏ä‡∏∑‡πà‡∏≠</th>`; dates.forEach(d => h+=`<th class="px-2 py-3 text-center bg-slate-800 border-b border-slate-700 min-w-[100px] whitespace-nowrap">${d}</th>`); thead.innerHTML = h; const list = dataState.students.filter(s=>s.classId==cid).sort((a,b)=>(Number(a.no)||0)-(Number(b.no)||0)); list.forEach(s => { let row = `<td class="px-4 py-2 text-center bg-slate-900 sticky left-0 z-10 border-r border-slate-800 text-slate-400">${s.no||'-'}</td><td class="px-4 py-2 bg-slate-900 sticky left-[40px] z-10 border-r border-slate-800 text-white">${s.name}</td>`; dates.forEach(d => { const log = dataState.attendance.find(a => a.studentId==s.id && formatThaiDate(a.date) == d); let t='-', c='text-slate-600'; if(log){ if(log.status=='‡∏°‡∏≤'){t='‚úî';c='text-green-500 font-bold';} else if(log.status=='‡∏•‡∏≤'){t='‡∏•';c='text-yellow-500';} else if(log.status=='‡∏Ç‡∏≤‡∏î'){t='‡∏Ç';c='text-red-500';} } row += `<td class="px-2 py-2 text-center border-b border-slate-800 ${c}">${t}</td>`; }); const tr=document.createElement('tr'); tr.innerHTML=row; tbody.appendChild(tr); }); };
      window.exportMatrixCSV = function() { if(!window.curAttDates) return; let csv = "\uFEFFNo,Name," + window.curAttDates.join(',') + "\n"; const rows = document.querySelectorAll('#att-matrix-body tr'); rows.forEach(r => { csv += Array.from(r.querySelectorAll('td')).map(d=>`"${d.innerText}"`).join(',') + "\n"; }); downloadCSV(csv, "att_matrix.csv"); };
      
      // Admin Material Render
      window.renderAdminMaterials = function() {
          const filterSub = document.getElementById('mat-filter-subject').value;
          const container = document.getElementById('admin-mat-list'); container.innerHTML = '';
          let list = dataState.materials; if(filterSub) list = list.filter(m => m.subjectId == filterSub);
          list.sort((a,b) => b.id - a.id).forEach(m => {
              const subName = dataState.subjects.find(s=>s.id == m.subjectId)?.name || '-';
              let icon = '<i class="fa-solid fa-link"></i>'; if(m.type === 'pdf') icon = '<i class="fa-solid fa-file-pdf text-red-400"></i>'; if(m.type === 'video') icon = '<i class="fa-brands fa-youtube text-red-500"></i>';
              const div = document.createElement('div'); div.className = "bg-slate-800 p-3 rounded-lg border border-slate-700 flex justify-between items-start hover:bg-slate-750 transition-colors";
              div.innerHTML = `<div class="flex gap-3"><div class="mt-1 text-xl bg-slate-900 w-10 h-10 rounded-full flex items-center justify-center border border-slate-600 shadow-inner">${icon}</div><div><h4 class="font-bold text-white text-sm hover:text-amber-400"><a href="${m.link}" target="_blank">${m.title}</a></h4><p class="text-[10px] text-slate-400 bg-slate-900 px-2 py-0.5 rounded inline-block mb-1">${subName} | ${m.type.toUpperCase()}</p><p class="text-xs text-slate-300 opacity-80">${m.desc || '-'}</p></div></div><button onclick="handleDeleteMaterial('${m.id}')" class="text-slate-500 hover:text-red-500 px-2"><i class="fa-solid fa-trash"></i></button>`; container.appendChild(div);
          });
          if(list.length === 0) container.innerHTML = '<div class="text-center text-slate-500 py-10">‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤</div>';
      };
      window.handleDeleteMaterial = function(id) { if(!confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö?")) return; saveAndRefresh({ action: 'deleteMaterial', id: id }); showToast("‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß", "bg-red-600"); };

      // Student Dashboard
      window.handleStudentLogin = function() {
          if (!dataState.students || dataState.students.length === 0) { alert("‚ö†Ô∏è ‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à"); syncData(); return; }
          const c = document.getElementById('student-login-id').value.trim();
          let s = dataState.students.find(x => x.code == c); 
          if(!s) {
              const s_loose = dataState.students.find(x => Number(x.code) == Number(c));
              if (s_loose) { s = s_loose; } else { alert(`‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô: ${c}`); return; }
          }
          document.getElementById('student-login-wrapper').classList.add('hidden');
          document.getElementById('student-dashboard').classList.remove('hidden');
          document.getElementById('std-dash-name').textContent = s.name;
          document.getElementById('std-dash-id').textContent = "ID: " + s.code;
          const cName = dataState.classes.find(cls => cls.id == s.classId)?.name || '-';
          document.getElementById('std-dash-class').textContent = "Class: " + cName;
          
          const myTasks = dataState.tasks.filter(t => t.classId == s.classId);
          const subjectsFound = [...new Set(myTasks.map(t => t.subjectId))];
          const container = document.getElementById('std-subjects-container');
          container.innerHTML = '';
          const today = getThaiDateISO();

          subjectsFound.forEach(subId => {
              const subName = dataState.subjects.find(sub => sub.id == subId)?.name || '‡∏ß‡∏¥‡∏ä‡∏≤ (‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏)';
              const subjectTasks = myTasks.filter(t => t.subjectId == subId);
              let chapScores = [0,0,0,0,0,0];
              for(let i=1; i<=6; i++) {
                  const cTasks = subjectTasks.filter(t => t.category === 'accum' && t.chapter == i);
                  let earn=0, max=0;
                  cTasks.forEach(t => { const sc = dataState.scores.find(x => x.studentId == s.id && x.taskId == t.id); earn += sc ? Number(sc.score) : 0; max += Number(t.maxScore); });
                  chapScores[i-1] = max > 0 ? Math.round((earn/max)*10) : 0;
              }
              const getSum = (cat) => { let sum = 0; subjectTasks.filter(t => t.category === cat).forEach(t => { const sc = dataState.scores.find(x => x.studentId == s.id && x.taskId == t.id); sum += sc ? Number(sc.score) : 0; }); return sum; };
              const mid = getSum('midterm'); const final = getSum('final'); const total = chapScores.reduce((a,b)=>a+b, 0) + mid + final; const grade = calGrade(total);

              // Materials
              const subMaterials = dataState.materials ? dataState.materials.filter(m => m.subjectId == subId) : [];
              let materialHtml = '';
              if(subMaterials.length > 0) {
                  materialHtml = `<div class="mt-4 pt-4 border-t border-slate-700"><h4 class="text-xs text-slate-400 mb-2 font-bold"><i class="fa-solid fa-book-open mr-1"></i> ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô / ‡∏™‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô</h4><div class="flex flex-col gap-2">`;
                  subMaterials.forEach(m => {
                      let icon = '<i class="fa-solid fa-link text-blue-400"></i>'; if(m.type === 'pdf') icon = '<i class="fa-solid fa-file-pdf text-red-400"></i>'; if(m.type === 'video') icon = '<i class="fa-brands fa-youtube text-red-500"></i>';
                      materialHtml += `<a href="${m.link}" target="_blank" class="flex items-center gap-3 bg-slate-900/60 hover:bg-slate-800 p-2 rounded-lg border border-slate-700/50 transition-all group"><div class="w-8 h-8 rounded-full bg-slate-800 flex items-center justify-center border border-slate-700 group-hover:border-amber-500/50">${icon}</div><div class="flex-1 min-w-0"><div class="text-xs font-bold text-slate-200 truncate group-hover:text-amber-400">${m.title}</div><div class="text-[10px] text-slate-500 truncate">${m.desc || '‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π'}</div></div><i class="fa-solid fa-chevron-right text-[10px] text-slate-600 group-hover:text-white"></i></a>`;
                  });
                  materialHtml += `</div></div>`;
              } else { materialHtml = `<div class="mt-4 pt-4 border-t border-slate-700 text-xs text-slate-600 text-center opacity-50">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</div>`; }

              const card = document.createElement('div');
              card.className = "glass p-5 rounded-2xl border border-slate-700 relative overflow-hidden";
              let html = `<h3 class="font-bold text-lg text-white mb-3 border-l-4 border-amber-500 pl-3">${subName}</h3>`;
              html += `<div class="overflow-x-auto mb-4"><table class="w-full text-sm text-center text-slate-300"><thead class="bg-slate-800 text-xs text-slate-400"><tr><th class="p-1">C1</th><th class="p-1">C2</th><th class="p-1">C3</th><th class="p-1">C4</th><th class="p-1">C5</th><th class="p-1">C6</th><th class="p-1 text-blue-400">Mid</th><th class="p-1 text-purple-400">Final</th><th class="p-1 text-white bg-slate-700">Total</th><th class="p-1 text-green-400">Grade</th></tr></thead><tbody><tr>${chapScores.map(c=>`<td class="p-1 font-bold">${c}</td>`).join('')}<td class="p-1 text-blue-300 font-bold">${mid}</td><td class="p-1 text-purple-300 font-bold">${final}</td><td class="p-1 text-white font-bold bg-slate-700/50">${total}</td><td class="p-1 text-green-400 font-bold text-lg">${grade}</td></tr></tbody></table></div>`;
              
              html += `<div class="mt-2"><h4 class="text-xs text-slate-400 mb-2 font-bold">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏á‡∏≤‡∏ô (‡∏Å‡∏î‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î)</h4><div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-2 max-h-60 overflow-y-auto pr-1">`;
              
              subjectTasks.forEach(t => {
                  const sc = dataState.scores.find(x => x.studentId == s.id && x.taskId == t.id);
                  const submission = dataState.submissions.find(x => x.studentId == s.id && x.taskId == t.id);
                  
                  let statusClass = "", statusText = "", icon = "", actionBtn = "";
                  
                  if(sc) { 
                      statusClass = "bg-green-900/30 border-green-600 text-green-400 hover:bg-green-900/50"; 
                      statusText = `${sc.score}`; 
                      icon = `<i class="fa-solid fa-check-circle mb-1"></i>`; 
                  }
                  else if (submission) {
                      statusClass = "bg-blue-900/30 border-blue-600 text-blue-400 hover:bg-blue-900/50";
                      statusText = "‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à";
                      icon = `<i class="fa-solid fa-hourglass-half mb-1"></i>`;
                  }
                  else if(t.dueDateISO < today) { 
                      statusClass = "bg-red-900/30 border-red-600 text-red-400 hover:bg-red-900/50"; 
                      statusText = "‡∏Ç‡∏≤‡∏î‡∏™‡πà‡∏á"; 
                      icon = `<i class="fa-solid fa-circle-exclamation mb-1"></i>`; 
                      actionBtn = `<button onclick="openSubmitModal('${t.id}', '${s.id}', '${t.name}')" class="mt-1 bg-red-700 hover:bg-red-600 text-white text-[10px] px-2 py-1 rounded w-full">‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô (‡∏ä‡πâ‡∏≤)</button>`;
                  }
                  else { 
                      statusClass = "bg-yellow-900/30 border-yellow-600 text-yellow-400 hover:bg-yellow-900/50"; 
                      statusText = "‡∏£‡∏≠‡∏™‡πà‡∏á"; 
                      icon = `<i class="fa-regular fa-clock mb-1"></i>`; 
                      actionBtn = `<button onclick="openSubmitModal('${t.id}', '${s.id}', '${t.name}')" class="mt-1 bg-yellow-600 hover:bg-yellow-500 text-white text-[10px] px-2 py-1 rounded w-full">‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô</button>`;
                  }

                  let detailText = `‡∏á‡∏≤‡∏ô: ${t.name}\n‡πÄ‡∏ï‡πá‡∏°: ${t.maxScore}\n\n‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:\n${t.description || '-'}`;
                  html += `
                    <div class="${statusClass} border rounded-lg p-3 flex flex-col items-center justify-center text-center transition-all relative">
                        <div onclick="alert('${detailText.replace(/\n/g, '\\n')}')" class="cursor-pointer w-full">
                            <div class="text-[10px] text-slate-300 absolute top-1 right-2 w-full text-right truncate pl-2 opacity-50">${t.category}</div>
                            <div class="text-lg mt-2">${icon}</div>
                            <div class="text-xs font-bold truncate w-full px-1 mb-1">${t.name}</div>
                            <div class="text-sm font-bold bg-slate-900/40 px-2 rounded mt-1">${statusText} <span class="text-[10px] font-normal opacity-70">/${t.maxScore}</span></div>
                        </div>
                        ${t.fileLink ? `<a href="${t.fileLink}" target="_blank" class="mt-1 text-[10px] bg-slate-700 hover:bg-slate-600 text-white px-2 py-0.5 rounded w-full flex items-center justify-center gap-1"><i class="fa-solid fa-file-pdf"></i> ‡πÇ‡∏à‡∏ó‡∏¢‡πå</a>` : ''}
                        ${actionBtn}
                    </div>
                  `;
              });
              html += `</div></div>`;
              html += materialHtml;
              card.innerHTML = html; container.appendChild(card);
          });

          const ab = document.getElementById('std-att-body'); ab.innerHTML = '';
          const atts = dataState.attendance.filter(a => a.studentId == s.id).sort((a,b) => b.date.localeCompare(a.date));
          atts.forEach(a => { const c = a.status == '‡∏°‡∏≤' ? 'text-green-400' : (a.status == '‡∏•‡∏≤' ? 'text-yellow-400' : 'text-red-400'); const tr = document.createElement('tr'); tr.innerHTML = `<td class="px-3 py-2 text-slate-400">${formatThaiDate(a.date)}</td><td class="px-3 py-2 text-center font-bold ${c}">${a.status}</td>`; ab.appendChild(tr); });
      };

      window.logoutStudent = function() { document.getElementById('student-dashboard').classList.add('hidden'); document.getElementById('student-login-wrapper').classList.remove('hidden'); document.getElementById('student-login-id').value=''; };
      
      function switchMainTab(t) { 
          document.getElementById('section-admin').classList.add('hidden'); 
          document.getElementById('section-student').classList.add('hidden'); 
          document.getElementById('tab-btn-admin').className="px-5 py-2 rounded-full text-sm font-semibold text-slate-400 hover:text-white hover:bg-slate-800 transition-all"; 
          document.getElementById('tab-btn-student').className="px-5 py-2 rounded-full text-sm font-semibold text-slate-400 hover:text-white hover:bg-slate-800 transition-all"; 
          
          if(t=='admin'){ 
              document.getElementById('section-admin').classList.remove('hidden');
              if(localStorage.getItem('wany_admin_session') === 'active') { showAdminPanel(); } 
              else { 
                  document.getElementById('admin-login-wrapper').classList.remove('hidden'); 
                  document.getElementById('admin-content-wrapper').classList.add('hidden'); 
                  document.getElementById('tab-btn-admin').className="px-5 py-2 rounded-full text-sm font-semibold text-white bg-red-700 shadow-lg transition-all"; 
              }
          } else { 
              document.getElementById('section-student').classList.remove('hidden'); 
              document.getElementById('tab-btn-student').className="px-5 py-2 rounded-full text-sm font-semibold text-white bg-blue-600 shadow-lg transition-all"; 
              document.getElementById('student-login-id').focus(); 
          } 
      }

      function switchAdminSubTab(t) { 
          document.querySelectorAll('.admin-panel').forEach(p=>p.classList.add('hidden')); 
          document.getElementById(`admin-panel-${t}`).classList.remove('hidden'); 
          document.querySelectorAll('.menu-btn').forEach(b=>{b.classList.remove('bg-red-800/80','text-white','shadow'); b.classList.add('text-slate-400');}); 
          document.getElementById(`menu-${t}`).classList.remove('text-slate-400'); 
          document.getElementById(`menu-${t}`).classList.add('bg-red-800/80','text-white','shadow'); 
          if(t=='attendance') renderLiveRoster(); 
          if(t=='scan') renderScoreRoster(); 
          if(t=='material') renderAdminMaterials();
          if(t=='homework') renderIncomingSubmissions(); 
      }

      function getThaiDateISO() { const d = new Date(); const utc = d.getTime() + (d.getTimezoneOffset() * 60000); const bangkok = new Date(utc + (7 * 3600000)); return `${bangkok.getFullYear()}-${String(bangkok.getMonth()+1).padStart(2,'0')}-${String(bangkok.getDate()).padStart(2,'0')}`; }
      function formatThaiDate(dateString) { if(!dateString) return "-"; if(dateString.includes('T') || dateString.includes('Z')) { const d = new Date(dateString); return `${d.getFullYear()}/${String(d.getMonth()+1).padStart(2,'0')}/${String(d.getDate()).padStart(2,'0')}`; } const [year, month, day] = dateString.split('-'); return `${year}/${month}/${day}`; }
      function downloadCSV(csv,n) { const l=document.createElement("a"); l.href=URL.createObjectURL(new Blob([csv],{type:"text/csv;charset=utf-8;"})); l.download=n; l.click(); }
      
      // New Submit Helper
      window.openSubmitModal = function(tid, sid, tname) {
          document.getElementById('submit-task-id').value = tid;
          document.getElementById('submit-student-id').value = sid;
          document.getElementById('submit-modal-title').textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô: " + tname;
          document.getElementById('submit-link-input').value = "";
          document.getElementById('submit-modal').classList.remove('hidden');
      };
  </script>
 </body>
</html>
